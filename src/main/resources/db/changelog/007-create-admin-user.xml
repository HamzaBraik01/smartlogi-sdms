<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">

    <!-- ============================================== -->
    <!-- Migration: Création de l'utilisateur Admin par défaut -->
    <!-- ============================================== -->

    <!-- Ajouter un administrateur par défaut -->
    <changeSet id="007-insert-default-admin" author="smartlogi">
        <comment>Crée un utilisateur administrateur par défaut pour la gestion des rôles et permissions</comment>

        <insert tableName="utilisateur">
            <column name="id" value="admin-default-001"/>
            <column name="nom" value="Admin"/>
            <column name="prenom" value="System"/>
            <column name="email" value="admin@smartlogi.com"/>
            <column name="telephone" value="+33100000000"/>
            <!-- Mot de passe: Admin@123 (BCrypt encoded) -->
            <column name="password" value="$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9lBOsl7iAt6Z5EH"/>
            <column name="role" value="ADMIN"/>
        </insert>

        <rollback>
            <delete tableName="utilisateur">
                <where>id = 'admin-default-001'</where>
            </delete>
        </rollback>
    </changeSet>

    <!-- Assigner toutes les permissions admin au rôle ADMIN -->
    <changeSet id="007-assign-all-permissions-to-admin" author="smartlogi">
        <comment>Donne au rôle ADMIN toutes les permissions du système</comment>

        <!-- Permissions COLIS -->
        <insert tableName="role_permission">
            <column name="role_id" value="role-admin-001"/>
            <column name="permission_id" value="perm-colis-create"/>
        </insert>
        <insert tableName="role_permission">
            <column name="role_id" value="role-admin-001"/>
            <column name="permission_id" value="perm-colis-read"/>
        </insert>
        <insert tableName="role_permission">
            <column name="role_id" value="role-admin-001"/>
            <column name="permission_id" value="perm-colis-update"/>
        </insert>
        <insert tableName="role_permission">
            <column name="role_id" value="role-admin-001"/>
            <column name="permission_id" value="perm-colis-delete"/>
        </insert>
        <insert tableName="role_permission">
            <column name="role_id" value="role-admin-001"/>
            <column name="permission_id" value="perm-colis-status"/>
        </insert>

        <!-- Permissions LIVREUR et ZONE -->
        <insert tableName="role_permission">
            <column name="role_id" value="role-admin-001"/>
            <column name="permission_id" value="perm-livreur-manage"/>
        </insert>
        <insert tableName="role_permission">
            <column name="role_id" value="role-admin-001"/>
            <column name="permission_id" value="perm-zone-manage"/>
        </insert>

        <!-- Permissions STATS -->
        <insert tableName="role_permission">
            <column name="role_id" value="role-admin-001"/>
            <column name="permission_id" value="perm-stats-view"/>
        </insert>

        <rollback>
            <delete tableName="role_permission">
                <where>role_id = 'role-admin-001' AND permission_id NOT IN ('perm-user-manage', 'perm-role-manage', 'perm-permission-manage')</where>
            </delete>
        </rollback>
    </changeSet>

</databaseChangeLog>

